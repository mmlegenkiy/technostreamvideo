%\Xi 
\documentclass[t]{beamer}  % [t], [c], или [b] --- вертикальное выравнивание на слайдах (верх, центр, низ)
%\documentclass[handout]{beamer} % Раздаточный материал (на слайдах всё сразу)
%\documentclass[aspectratio=169]{beamer} % Соотношение сторон

%\usetheme{Berkeley} % Тема оформления
%\usetheme{Bergen}
%\usetheme{Szeged}

%\usecolortheme{beaver} % Цветовая схема
%\useinnertheme{circles}
%\useinnertheme{rectangles}

%\usetheme{HSE}

%%% Работа с русским языком
\usepackage{cmap}					% поиск в PDF
\usepackage{mathtext} 				% русские буквы в формулах
\usepackage[T2A]{fontenc}			% кодировка
\usepackage[utf8]{inputenc}			% кодировка исходного текста
\usepackage[english,ukrainian]{babel}	% локализация и переносы

\usepackage{hyperref}

%%% Работа с картинками
\usepackage{graphicx}  % Для вставки рисунков
\graphicspath{{images/}{images2/}}  % папки с картинками
\setlength\fboxsep{3pt} % Отступ рамки \fbox{} от рисунка
\setlength\fboxrule{1pt} % Толщина линий рамки \fbox{}
\usepackage{wrapfig} % Обтекание рисунков текстом

%%% Работа с таблицами
\usepackage{array,tabularx,tabulary,booktabs} % Дополнительная работа с таблицами
\usepackage{longtable}  % Длинные таблицы
\usepackage{multirow} % Слияние строк в таблице

%%% Программирование
\usepackage{etoolbox} % логические операторы

%%% Другие пакеты
\usepackage{lastpage} % Узнать, сколько всего страниц в документе.
\usepackage{soul} % Модификаторы начертания
\usepackage{csquotes} % Еще инструменты для ссылок
%\usepackage[style=authoryear,maxcitenames=2,backend=biber,sorting=nty]{biblatex}
\usepackage{multicol} % Несколько колонок

%%% Картинки
\usepackage{tikz} % Работа с графикой
\usepackage{pgfplots}
\usepackage{pgfplotstable}

\title{LINUX Технострім}
%\subtitle{За матеріалами "Системне адміністрування Linux" Сергія Клочкова}
\author{Легенький М.М.}
\date{\today}
\institute[факультет радіофізики, біомедичної електроніки та комп'ютерних систем]{Харківський національний університет імені В. Н. Каразіна}

\begin{document}

\frame[plain]{\titlepage}	% Титульный слайд

\section{Робота з командним рядком}
\subsection{Вступ}
 
\begin{frame}
	\frametitle{\insertsection} 
	\framesubtitle{\insertsubsection}
Дистрибутиви Linux.

Способи поширення ПЗ: у вигляді вихідних кодів (Gentoo) або у бінарному вигляді (Ubuntu). Політика оновлення ПЗ: стабільність (RHEL) або актуальність (Archlinux).		 

Єдине дерево директорій.
\begin{itemize}
\item /etc - конфігурація.
\item /home - дані користувачів.
\item /usr - додатки.
\item /var - дані та логи.
\item /tmp - тимчасові файли.
\end{itemize}
\end{frame}

\subsection{Основи роботи в системі Linux}
 
\begin{frame}
	\frametitle{\insertsection} 
	\framesubtitle{\insertsubsection}
Порядок завантаження персонального комп'ютера системи IBM PC:
\begin{itemize}
\item Ініціалізація та перевірка працезданості обладнання (POST).
\item Передача керування завантажувачу з якогось локального пристрою  або мережею.
\item Для завантаження з локального диску необхідно, щоб на цьому диску була таблиця розділів, що підтримується BIOS, та був завантажувач.
\item Основні види таблиць розділів MBR (sudo dd if=/dev/sda bs=512 count=1 $|$ file -) та GPT (використовується службовий розділ розміром 2 Мб, де знаходиться завантажувач). 
\item Завантажувач з MBR (stage1) запускає інший більш фунціональний завантажувач (stage2). 
\item Далі завантажувачу треба запустити ядро операційної системи (при цьому може демонструватись меню).
\item initrd використовується щоб безпосередньо розпочати роботу з обладнаннням.
\item Далі запускається init щоб запустити всі процеси та примонтувати всі файлові систем окрім кореневої.
\end{itemize}

\end{frame}

 \begin{frame}
 	\frametitle{\insertsection} 
 	\framesubtitle{\insertsubsection}
Ядро ОС потрібне для абстракції обладнання, для керування виділенням ресурсів користувацьким процесам  та для забезпечення доступу процесів до деякої низки ресурсів (за допомогою системних викликів).

Команда sysctl дозволяє продивлятись та змінювати параметри ядра Linux.

Утиліта modprobe використовується для додавання завантажуваних модулів до ядра Linux. Можна продивлятися та видаляти модулі за допомогою команди modprobe.
\end{frame}

\begin{frame}
 	\frametitle{\insertsection} 
 	\framesubtitle{\insertsubsection}
Операційна система розв'язує різні задачі за допомогою керування процесами. Процес складається із образу коду, що виконується, адресного простору, набору дескрипторів (нумеровані ресурси, що виділені процесу ядром, вони відповідають за операції вводу-виводу), атрибути доступу, контекст процесора (регістри, вказівники на стеки тощо).

Псевдофайлова система procfs примонтована в директорію /proc. Інформацію про процес можна подивитись у файлі /proc/PID/status.

Виділений процесу адресний простір не завжди відповідає реально зайнятій пам'яті. Реально виділяється пам'ять тільки, коли процес намагається записати туди дані (це робиться за допомогою таблиці трансляції сторінок). Якими блоками виділяється пам'ять? 4 Кб - сторінка пам'яті в архітектурі х86, адреса сторінки 8 байт. 
\end{frame}

\begin{frame}
 	\frametitle{\insertsection} 
 	\framesubtitle{\insertsubsection}
Робота із таблицею трансляції сторінок є критичною і вона реалізована апаратно. За неї відповідає MMU - модуль керування пам'яттю в центральному процесорі. Також для цього виділено дуже швидкий та дуже маленький кеш (на багатьох процесорах приблизно 1024 записи). Однак 1024 * 4 Кб = 4 Мб. Якщо ж відбувається звертання до сторінки, що не знаходиться в цьому кеші, доводиться звертатися до оперативної пам'яті і це довго. 

Збільшення розміру сторінки завжди призводе до збільшення кількості оперативної пам'яті, що не використовується.

\end{frame}

\begin{frame}
 	\frametitle{\insertsection} 
 	\framesubtitle{\insertsubsection}
Тому алокацію пам'яті в архитектурі х64 можна зробити не тільки на сторінку розміром 4 Кб, але і на велику сторінку (Huge page) розміром 2 Мб. Таким чином, в швидкому кеші знаходяться 1024* 2Мб = 2 Гб даних.
 За допомогою sysctl можна виділити кількість великих сторінок, які будуть в системі sysctl vm.nr\_hugepages. До цієї пам'яті можуть звернутися лише ті додатки, для яких її призначено. Ці звертання завжди будуть швидкими (пам'ять не може бути витіснена в режим підкачки). Недолік: мінімальна гибкість. Виділення сторінок повинно відбуватися при старті системи, вони повинні виділятися підряд.
 
 Тому для роботи з великими сторінками придумали прозорі великі (анонімні) великі сторінки. cat /proc/meminfo $|$ grep AnonHugePages. Ядро саме вирішує які саме сторінки пам'яті виділити додатку, але ці сторінки можуть бути витіснені до розділу підкачки.
\end{frame}

\begin{frame}
 	\frametitle{\insertsection} 
 	\framesubtitle{\insertsubsection}
Інший вид ресурсу, що виділяється процесу - дескриптор вводу/виводу. Стандартні дескриптори - 0 (stdin), 1 (stdout) та 2 (stderr). Список виділених процесу дескрипторів знаходиться в директорії /proc/PID/fd. Інформацію про ці дескриптори можна подивитись у файлі /proc/PID/fdinfo/PID1 (опції, з якими їх було відкрито, позиції; де знаходиться в файлі процес тощо).

lsof - утиліта, що виводе інформацію про те які файли використовуються тими чи іншими процесами. lsof в стовпці FD виводе різні службові значення: txt (виконуваний файл додатку), mem (різні файли, розміщені в адресному просторі даного процесу), cwd (поточна робоча директорія), rtd (коренева директорія процесу).
\end{frame}

\begin{frame}
 	\frametitle{\insertsection} 
 	\framesubtitle{\insertsubsection}
Головний ресурс процесу - ресурси процесора. Процес використовує час  процесору в коді додатку (us (user space) в top) та в коді ядра (sy в top). Для моніторингу використовується утиліта top (ni -процеси зі зменшеним пріорітетом, wa - очикування вводу/виводу, hi - апаратні переривання , si - програмні переривання, st - час, витрачений іншими віртуальними машинами ).
).
\end{frame}

\end{document}
